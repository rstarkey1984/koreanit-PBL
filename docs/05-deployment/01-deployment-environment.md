# 애플리케이션 배포 환경구성

이 문서는 서버 프로그램 배포 실습을 위한 **환경 구성 기준**을 정의한다.
이 단계의 목적은 "코드를 실행하기 전에, 실행될 수 있는 환경을 고정"하는 것이다.

---

## 학습 목표

* Docker 기반 배포 환경의 전체 구조를 이해한다
* 컨테이너와 호스트 간 네트워크 규칙을 설명할 수 있다
* 배포 실패를 유발하는 환경 설정 오류를 사전에 제거한다

---

## 1. 배포 아키텍처 개요

요청 흐름은 반드시 다음 구조를 따른다.

브라우저 → Nginx 컨테이너(80) → API 컨테이너(9092) → MySQL(호스트) / Redis(컨테이너)

이 흐름은 이후 단계에서 **절대 변경하지 않는 기준선**이다.

---

## 2. 컨테이너 네트워크 규칙

### 2-1. localhost 규칙

* 컨테이너 내부에서 `localhost`는 자기 자신을 의미한다
* 컨테이너에서 호스트 DB에 접근할 때 `localhost`를 사용하면 안 된다

### 2-2. 접근 규칙 정리

* 컨테이너 → 호스트 : `host.docker.internal`
* 컨테이너 → 컨테이너 : docker compose 서비스명
* 외부 → 서비스 : Nginx(80)

---

## 3. MySQL / Redis 환경 전제

### 3-1. MySQL

* MySQL은 호스트에서 실행된다
* 포트는 3308을 사용한다
* 컨테이너에서 접근 시 `host.docker.internal:3308`을 사용한다

### 3-2. Redis

* Redis는 docker compose로 실행된다
* API 컨테이너에서는 `redis:6379`로 접근한다

---

## 4. hosts 설정

배포 테스트를 위해 도메인을 고정한다.

```
127.0.0.1 www.localhost
```

이를 통해 실제 서비스와 유사한 접근 구조를 만든다.

---

## 5. 이 단계의 완료 기준

* docker compose가 정상 기동된다
* 컨테이너에서 호스트 MySQL 접근이 가능하다
* [www.localhost](http://www.localhost) 요청이 Nginx까지 도달한다

## 다음 단계

→ [**소스 검증**](/docs/05-deployment/02-source-verification.md)

